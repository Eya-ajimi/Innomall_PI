package tn.esprit.gui;

import javafx.fxml.FXML;
import javafx.scene.control.Button;
import javafx.scene.control.Label;
import tn.esprit.entites.Produit;
import tn.esprit.entites.LikeProduit;
import tn.esprit.services.LikeProduitService;

public class ProduitCardController {
    @FXML private Label nomLabel;
    @FXML private Label prixLabel;
    @FXML private Label stockLabel;
    @FXML private Label Description;
    @FXML private Button likeButton; // Like button from FXML

    private Produit currentProduit;

    public void setData(Produit produit) {
        this.currentProduit = produit;
        nomLabel.setText(produit.getNom());
        prixLabel.setText("Price: $" + produit.getPrix());
        stockLabel.setText("Stock: " + produit.getStock());
        Description.setText(produit.getDescription());

        // Use user 14 as current user
        int currentUserId = 14;
        LikeProduitService likeService = new LikeProduitService();
        try {
            // Check if the product is already liked by user 14
            boolean isLiked = likeService.isLiked(currentUserId, produit.getId());
            if (isLiked) {
                likeButton.setText("Liked");
                // Optionally, you can change the graphic to a filled heart icon
            } else {
                likeButton.setText("Like");
            }
        } catch (Exception e) {
            e.printStackTrace();
        }

        // Set up the action handler to add a like only if not already liked.
        likeButton.setOnAction(event -> {
            // If already liked, do nothing (or optionally allow unliking)
            if(likeButton.getText().equals("Liked")){
                return;
            }
            try {
                LikeProduit like = new LikeProduit(currentUserId, produit.getId());
                likeService.insert(like);
                likeButton.setText("Liked");
            } catch (Exception e) {
                e.printStackTrace();
            }
        });
    }
}
